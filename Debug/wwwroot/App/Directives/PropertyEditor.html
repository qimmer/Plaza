<div style="width: 100%; height: 40px;" class="bg-toolbox-header toolbox-header">
        Properties
</div>
<div style="display: block;">
    <button style="width: calc(50% - 2px)" ng-disabled="selectedEntityHistory.length <= 1" class="btn btn-secondary" ng-click="navigateBack()"><span class="im im-angle-left"></span> Back</button>
    <button style="width: calc(50% - 2px)" ng-disabled="!selectedEntities[0] || !selectedEntities[0].length" class="btn btn-secondary" ng-click="navigateUp()"><span class="im im-angle-up"></span> Up</button>
</div>
<div style="width: 100%; height: calc(100% - 80px); overflow-y: scroll;">        
    <div ng-show="draft">
        <div ng-repeat="componentName in draft.$components.filter(isComponentVisible).sort(componentComparator)" style="border-bottom: 1px solid #222;">
            <div class="component-header" ng-click="collapsedComponents[componentName] = !collapsedComponents[componentName]">
                {{componentName.prettify()}}
            </div>
            <div class="property-container fade-in" ng-hide="collapsedComponents[componentName]" >
                <div class="table">
                    <div class="row" ng-repeat="property in getProperties(componentName)">
                        <div class="cell label">
                            {{property.Name.replace(componentName,'').prettify()}}
                        </div>
                        <div class="cell value" ng-if="property.PropertyKind == 1">
                            <input
                                class="form-control" 
                                ng-change="lockDraft()" 
                                ng-blur="applyDraft();" 
                                ng-focus="lockDraft()"
                                ng-if="property.PropertyType == 'StringRef'"
                                ng-model="draft[property.Name]"
                                ng-keypress="keyPress($event.keyCode)"
                            />

                            <input
                                class="form-control" 
                                ng-change="lockDraft()" 
                                ng-blur="applyDraft();" 
                                ng-focus="lockDraft()"
                                type="number" 
                                ng-if="(property.PropertyType[0] == 'u' || property.PropertyType[0] == 's') && property.PropertyEnum === null" 
                                ng-model="draft[property.Name]" 
                                ng-keypress="keyPress($event.keyCode)"
                            />

                            <input
                                class="form-control"
                                ng-change="lockDraft()" 
                                ng-blur="applyDraft();" 
                                ng-focus="lockDraft()"
                                type="number" 
                                ng-if="property.PropertyType == 'float' || property.PropertyType == 'double'" 
                                ng-model="draft[property.Name]" 
                                ng-keypress="keyPress($event.keyCode)"
                            />

                            <button 
                                style="width: 100%;" 
                                class="btn" 
                                ng-class="draft[property.Name] ? 'btn-success' : 'btn-disabled'" 
                                ng-if="property.PropertyType == 'bool'" 
                                ng-click="draft[property.Name] = !draft[property.Name]; applyDraft()">
                                {{draft[property.Name] ? 'true' : 'false'}}
                            </button>

                            <button 
                                style="width: calc(100% - 35px); direction: rtl; text-align: left;" 
                                class="btn" 
                                ng-class="draft[property.Name] ? 'btn-primary' : 'btn-disabled'" 
                                ng-if="property.PropertyType == 'Entity'" 
                                ng-click="selectedEntities[0] = draft[property.Name]"
                                ng-disabled="(draft[property.Name] === null)">
                                {{draft[property.Name] ? draft[property.Name].split('/').slice(-1)[0] : 'null'}}
                            </button>
                            <button 
                                style="width: 32px;" 
                                class="btn btn-default" 
                                ng-if="property.PropertyType == 'Entity'" 
                                ng-click="pickEntity()">
                                ...
                            </button>

                            <select 
                                class="form-control"
                                style="width: 100%;" 
                                ng-if="property.PropertyType == 'Type'" 
                                ng-model="draft[property.Name]"
                                ng-options="type.value as type.name for type in types"
                            />
                        </div>
                        <div class="cell value" ng-if="property.PropertyKind == 2">
                            <button 
                                style="width: 100%; direction: rtl; text-align: left;" 
                                class="btn btn-primary"
                                ng-click="selectedEntities[0] = draft[property.Name]">
                                {{draft[property.Name] ? draft[property.Name].split('/').slice(-1)[0] : 'null'}}
                            </button>
                        </div>
                        <div class="cell value" ng-if="property.PropertyKind == 3">
                            <button class="btn btn-secondary" style="width: calc(100% - 43px);" ng-disabled="draft[property.Name].length == 0" ng-click="expandedArrays[property.Name] = !expandedArrays[property.Name]">{{draft[property.Name].length.toString() + ' items '}}<span class="im" ng-if="draft[property.Name].length > 0" ng-class="expandedArrays[property.Name] ? 'im-angle-down' : 'im-angle-right'"></span></button>
                            <button class="btn btn-success" style="width: 40px;" ng-click="expandedArrays[property.Name] = true; addChild(property.Name)"><span class="im im-plus"></span></button>
                            <div ng-show="expandedArrays[property.Name]" style="width: 100%; display: block;" class="fade-in">
                                <div ng-repeat="childPath in draft[property.Name]">
                                        <button
                                        style="width: calc(100% - 43px); margin-top: 1px;" 
                                        class="btn btn-primary btn-sm" 
                                        ng-click="selectedEntities[0] = childPath">
                                        {{childPath.split('/').slice(-1)[0]}}
                                    </button>
                                    <button class="btn btn-danger btn-sm" style="width: 40px;" ng-click="destroyEntity(childPath)"><span class="im im-trash-can"></span></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div align="center" ng-if="!draft" style="display: table; width: 100%; height: 100%; color: #353535;">
        <h1 style="display: table-cell; vertical-align: middle; user-select: none; font-weight: 200;">No entity selected</h1>
    </div>
</div>
